geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ c(poly(length, 2)) + poly(budget_1m, 2) + poly(votes_1k, 2), data = ds)
fit.poly %>%
augment() %>%
melt(measure.vars =ds$length, ds$budget_1m,
ds$votes_1k, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
poly_squared <- poly(length,2)
poly_squared <- poly(ds$length,2)
poly_squared
c(poly_squared)
fit.poly <- lm(rating ~ c(poly_squared) + poly(budget_1m, 2) + poly(votes_1k, 2), data = ds)
fit.poly <- lm(rating ~ c(poly_squared) + c(budget_squared) + c(votes_squared), data = ds)
len_squared <- poly(ds$length,2)
budget_squared <- poly(ds$budget_1m,2)
votes_squared <- poly(ds$votes_1k,2)
fit.poly <- lm(rating ~ c(poly_squared) + c(budget_squared) + c(votes_squared), data = ds)
fit.poly <- lm(rating ~ c(len_squared) + c(budget_squared) + c(votes_squared), data = ds)
len_squared <- poly(ds$length,2)
budget_squared <- poly(ds$budget_1m,2)
votes_squared <- poly(ds$votes_1k,2)
fit.poly <- lm(rating ~ c(len_squared) + c(budget_squared) + c(votes_squared), data = ds)
length(c(len_squared))
length(c(budget_squared))
length(c(votes_squared))
len(ds$rating)
lenth(ds$rating)
length(ds$rating)
length(ds$length)
View(votes_squared)
votes_squared
votes_squared[0]
votes_squared[1]
votes_squared[1,]
votes_squared['poly']
c(len_squared[0])
c(len_squared[1])
c(len_squared[2])
c(len_squared[,1])
c(len_squared[,2])
c(len_squared[,1])
fit.poly <- lm(rating ~ c(len_squared[,1]) + c(budget_squared[,1]) + c(votes_squared[,1]), data = ds)
fit.poly %>%
augment() %>%
melt(measure.vars =ds$length, ds$budget_1m,
ds$votes_1k, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
c(len_squared[,1])
fit.poly %>%
augment() %>%
melt(measure.vars =ds$length, ds$budget_1m,
ds$votes_1k, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
melt(measure.vars = c(len_squared) + c(budget_squared) + c(votes_squared), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
melt(measure.vars = len_squared + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ len_squared + budget_squared + votes_squared, data = ds)
fit.poly %>%
augment() %>%
melt(measure.vars = len_squared + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
mutate(fit1.r = residuals(fit1)) ->ds
ggplot(ds,aes(fit1.r)) +
geom_density() +
stat_function(fun = dnorm, args = list(mean = mean(ds$fit1.r),
sd = sd(ds$fit1.r)), color = "red") +
ggtitle("First Linear Model")
ds %>%
mutate(log.r = residuals(fit.log)) -> ds
ggplot(ds, aes(log.r)) +
geom_density() +
stat_function(fun = dnorm, args = list(mean = mean(ds$log.r),
sd = sd(ds$log.r)), color = "red") +
ggtitle("Log Linear Model")
ds %>%
mutate(poly.r = residuals(fit.poly)) -> ds
ggplot(ds, aes(poly.r)) +
geom_density() +
stat_function(fun = dnorm, args = list(mean = mean(ds$poly.r),
sd = sd(ds$poly.r)), color="red") +
ggtitle("Polynomial Model")
df.length <- fit.log %>%
augment(newdata = data.frame(length = 89:134,
budget_1m = mean(ds$budget_1m),
votes_1k = mean(ds$votes_1k))) %>%
mutate(upper = .fitted + 1.96 * .se.fit,
lower = .fitted - 1.96 * .se.fit)
df.budget <- fit.log %>%
augment(newdata = data.frame(length = mean(ds$length),
budget_1m = 5:80,
votes_1k = mean(ds$votes_1k))) %>%
mutate(upper = .fitted + 1.96 * .se.fit,
lower = .fitted - 1.96 * .se.fit)
df.votes <- fit.log %>%
augment(newdata = data.frame(length = mean(ds$length),
budget_1m = mean(ds$budget_1m),
votes_1k = 1.645:25.964)) %>%
mutate(upper = .fitted + 1.96 * .se.fit,
lower = .fitted - 1.96 * .se.fit)
ggplot(df.length, aes(length, .fitted)) +
geom_line(size = 1, color = "royalblue") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2) +
coord_cartesian(ylim = c(4:8), xlim = c(89:134)) +
ggtitle("Movie Length and Rating") +
xlab("Length") +
ylab("Rating") +
theme_bw()
ggplot(df.votes, aes(votes_1k, .fitted)) +
geom_line(size = 1, color = "royalblue") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2) +
ggtitle("IMDB Votes and Rating") +
xlab("Votes (Thousands)") +
ylab("Rating") +
theme_bw()
ggplot(df.budget, aes(budget_1m, .fitted)) +
geom_line(size = 1, color = "royalblue") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2) +
ggtitle("Movie Budget and Rating") +
xlab("Budget (Millions)") +
ylab("Rating") +
theme_bw()
fit.poly <- lm(rating ~ poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), data = ds)
fit.poly %>%
augment() %>%
melt(measure.vars = len_squared + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
View(fit.poly)
fit.poly$terms
fit.poly["poly(length,2)"]
fit.poly
fit.poly$coefficients
fit.poly[[1]]
fit.poly[[2]]
fit.poly[[1]]
fit.poly[[3]]
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
fit.poly %>%
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_1m,2) + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
? poly_melt
install.packages("polypoly")
library(polypoly)
fit.poly %>%
augment() %>%
%>% poly_melt(ds$length)
fit.poly %>%
augment() %>%
poly_melt(ds$length) %>%
melt(measure.vars = poly(length,2) + poly(budget_1m,2) + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(ds$length) %>%
melt(measure.vars = poly(budget_1m,2) + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
? poly_melt
fit.poly %>%
augment() %>%
poly_melt(ds$length) %>%
poly_melt(ds$budget_1m) %>%
poly_melt(ds$votes_1k) %>%
melt(measure.vars = ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(ds$length) %>%
poly_melt(ds$budget_1m) %>%
poly_melt(ds$votes_1k) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(ds$length) %>%
poly_melt(ds$budget_1m) %>%
poly_melt(ds$votes_1k) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ poly_melt(poly(length,2)) + poly(budget_1m,2) + poly(votes_1k,2), data = ds)
fit.poly <- lm(rating ~ poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), data = ds)
fit.poly %>%
augment() %>%
poly_melt(length) %>%
poly_melt(budget_1m) %>%
poly_melt(votes_1k) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(poly.length..2) %>%
poly_melt(budget_1m) %>%
poly_melt(votes_1k) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(poly.length..2.) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(votes_1k) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
poly_melt(poly.length..2.) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(poly.votes_1k..2.) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
poly_melt(poly.length..2.) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(poly.votes_1k..2.) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
poly_melt(poly.length..2.) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(poly.votes_1k..2.) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
poly_melt(poly(ds$length,2)) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(poly.votes_1k..2.) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
poly_length <- poly(ds$length,2)
fit.poly %>%
poly_melt(poly_length) %>%
poly_melt(poly.budget_1m..2.) %>%
poly_melt(poly.votes_1k..2.) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
? poly_melt
poly_melt(poly_length)
? melt
fit.poly %>%
augment() %>%
melt(measure.vars = length + budget_squared + votes_squared, ".fitted")
ds %>%
augment() %>%
melt(measure.vars = length + budget_squared + votes_squared, ".fitted")
ds %>%
augment() %>%
melt(measure.vars = length + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), data = ds)
ds %>%
augment() %>%
melt(measure.vars = length + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(ds$length,2) + budget_squared + votes_squared, ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_squared,2) + poly(votes_squared,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ poly(length,2) + poly(budget_1m,2) + poly(votes_1k,2), data = ds)
ds %>%
augment() %>%
melt(measure.vars = poly(length,2) + poly(budget_squared,2) + poly(votes_squared,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(length,2),  poly(budget_squared,2), poly(votes_squared,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(length,2),  poly(budget_squared,2), poly(votes_squared,2), ".fitted")) %>%
ds %>%
augment() %>%
melt(measure.vars = poly(length,2),  poly(budget_squared,2),
poly(votes_squared,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
melt(measure.vars = poly(length,2),  poly(budget_squared,2),
poly(votes_squared,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(length,2),  poly(budget_1m,2),
poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
augment() %>%
melt(measure.vars = poly(length,2), poly(budget_1m,2),
poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly %>%
augment() %>%
melt(measure.vars = poly(length,2), poly(budget_1m,2),
poly(votes_1k,2), ".fitted") %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
```{r 11_setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidyverse)
library(psych)
library(car)
library(stargazer)
library(reshape2)
library(car)
library(stargazer)
library(reshape2)
library(stargazer)
library(MASS)
library(plotly)
library(tidyverse)
library(psych)
library(car)
library(stargazer)
library(reshape2)
library(stargazer)
library(MASS)
library(plotly)
library(sandwich)
ds <- read_csv("https://github.com/ripberjt/qrmlabs/raw/master/imdb_2014.csv")
ds <- read_csv("https://github.com/ripberjt/qrmlabs/raw/master/imdb_2014.csv")
options(scipen = 999)
fit.poly <- lm(rating ~ poly(length, 2) + poly(budget_1m, 2) + poly(votes_1k, 2), data = ds)
fit.poly %>%
augment() %>%
melt(measure.vars = c("poly.length..2.", "poly.budget_1m..2.",
"poly.votes_1k..2.",
".fitted")) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape = 1) +
geom_smooth(method = "loess") +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
fit.poly <- lm(rating ~ poly(length, 2) + poly(budget_1m, 2) + poly(votes_1k, 2), data = ds)
fit1 %>%
augment() %>%
melt(measure.vars = c("length", "budget_1m", "votes_1k", ".fitted")) %>%
ggplot(., aes(value, .std.resid)) +
geom_point(shape=1) +
geom_smooth(method = loess) +
geom_hline(yintercept = 0) +
facet_wrap(~variable, scales = "free")
ds %>%
mutate(budget_1m = budget/1000000,
votes_1k = votes/1000,
f.year = factor(year)) -> ds
fit.poly <- lm(rating ~ poly(length, 2) + poly(budget_1m, 2) + poly(votes_1k, 2), data = ds)
melt.ds <- melt(ds, measure.vars = c("length", "budget_1m", "rating", "votes_1k"))
ggplot(melt.ds, aes(value)) +
geom_histogram(fill="#0000FF") +
facet_wrap(~variable, scale="free")
vote <- ggplot(ds, aes(votes_1k, rating, label = title)) +
geom_point(color = "#0000FF50") +
geom_smooth(method = "loess", se = FALSE, color = "green") +
geom_smooth(method = "lm", se = FALSE, color = "red") +
ggtitle("# of Votes and Rating")
ggplotly(vote)
